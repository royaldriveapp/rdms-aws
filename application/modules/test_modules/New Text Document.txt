function bindVoxbayDailyCallReport() {
    var salesStaffs = [];
    $('.multiselect-container').find('.active').each(function (index) {
        salesStaffs.push($(this).find('input').val());
    });

    $('#voxbayDailyCallReport').DataTable().clear().destroy();
    $('#voxbayDailyCallReport').DataTable({
        "order": [[1, "asc"]],
        "processing": true,
        "serverSide": true,
        'serverMethod': 'post',
        "ajax": {
            "type": "POST",
            "url": site_url + "reports/voxbayDailyCallReport_ajax",
            "data": {
                'fData': $('.dtpDateFrom').val(),
                'tData': $('.dtpDateTo').val(),
                'se': salesStaffs
            }
        },
        'columns': [
            { data: 'vreg_entry_date' },
            { data: 'ccb_callerNumber' },
            { data: 'vreg_cust_name' },
            { data: 'vreg_cust_place' },
            { data: 'ccb_AgentNumber' },
            { data: 'addedby_usr_first_name' },
            { data: 'assign_usr_first_name' },
            { data: 'vreg_customer_remark' }
        ]
    });
}
$(document).ready(function () {
    $(document).on('keyup', '.txtVehicleNo', function () {
        var url = $(this).data('url');
        var txtprdRegnoPrt1 = $('.txtprdRegnoPrt1').val();
        var txtprdRegnoPrt2 = $('.txtprdRegnoPrt2').val();
        var txtprdRegnoPrt3 = $('.txtprdRegnoPrt3').val();
        var txtprdRegnoPrt4 = $('.txtprdRegnoPrt4').val();

        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: {
                'regNo1': txtprdRegnoPrt1,
                'regNo2': txtprdRegnoPrt2,
                'regNo3': txtprdRegnoPrt3,
                'regNo4': txtprdRegnoPrt4
            },
            success: function (resp) {
                if (resp.action) {
                    $('.divAlreadyImageUploaded').html(resp.msg);
                    $('.frmSearchVehicleNumber').attr('action', resp.action);
                }

                $('.cmbModel').html('<option value="">Select model</option>');
                $.each(resp.model, function (index, value) {
                    $('.cmbModel').append('<option value="' + value.mod_id + '">' + value.mod_title + '</option>');
                });

                $('.cmbVariant').html('<option value="">Select variant</option>');
                $.each(resp.variant, function (index, value) {
                    $('.cmbVariant').append('<option value="' + value.var_id + '">' + value.var_variant_name + '</option>');
                });

                $('.cmbBrand option[value="' + resp.val_brand + '"]').attr("selected", "selected");
                $('.cmbModel option[value="' + resp.val_model + '"]').attr("selected", "selected");
                $('.cmbVariant option[value="' + resp.val_variant + '"]').attr("selected", "selected");
                $('.cmbManfYear option[value="' + resp.val_minif_year + '"]').attr("selected", "selected");
                $('.txtKM').val(resp.val_km);
                $('.txtValuationId').val(resp.val_id);
                $('.txtInsurance').val(resp.val_insurance_comp_date);
                $('.cmbFuel option[value="' + resp.val_fuel + '"]').attr("selected", "selected");
                $('.txtMileage').val(resp.val_milage);
                $('.txtOwner').val(resp.val_no_of_owner);
                $('.txtCC').val(resp.val_eng_cc);
                $('.txtIDV').val(resp.val_insurance_comp_idv);
            }
        });
    });
    $(document).on('change', '.cmbBindIssuesAssets', function () {
        var id = $(this).val();
        var url = $(this).data('url');
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: {
                id: id
            },
            success: function (resp) {
                $('.tbIssuedAssets').html(resp.html);
            }
        });
    });
    /*Jafer*/
    $(document).on('submit', '.submitPrefrnc', function (e) {
        e.preventDefault();
        var _this = $(this);
        var url = $(this).attr('action');
        var formData = new FormData($(this)[0]);
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            async: false,
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            beforeSend: function (xhr) {
                $(_this).find("button[type='submit']").prop('disabled', true);
            },
            success: function (resp) {
                if (resp.status == 'success') {
                    $('.submitPrefrnc')[0].reset();
                    messageBox(resp);
                    setTimeout(function () {
                        $('#popPreferences').modal('toggle');
                    }, 1000);
                }
            }
        });
    });
    $(document).on('submit', '.submitProcReq', function (e) {
        var _this = $(this);
        e.preventDefault();
        var url = $(this).attr('action');
        var formData = new FormData($(this)[0]);
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            async: false,
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            beforeSend: function (xhr) {
                $(_this).find("button[type='submit']").prop('disabled', true);
            },
            success: function (resp) {
                if (resp.status == 'success') {
                    messageBox(resp);
                    setTimeout(function () {
                        $('#procModal').modal('toggle');
                        location.reload();
                    }, 2000);
                }
            }
        });
    });

    $(document).on('submit', '.submitProcStatus', function (e) {
        e.preventDefault();
        var url = $(this).attr('action');
        var formData = new FormData($(this)[0]);
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            async: false,
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (resp) {
                if (resp.status == 'success') {
                    messageBox(resp);
                    location.reload();
                }
            }
        });
    });
    $(document).on('submit', ".submitHomeVisit", function (e) {
        e.preventDefault();
        var url = $(this).attr('action');
        var formData = new FormData($(this)[0]);
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: formData,
            async: false,
            cache: false,
            contentType: false,
            processData: false,
            beforeSend: function (xhr) {
                //  $('.divLoading').show();
            },
            success: function (resp) {
                $('.divLoading').hide();
                $('.msgBox').show();
                setTimeout(function () {
                    $('.msgBox').fadeOut();
                }, 1500);

                $("#home_Visit").trigger("reset");
                $("#homeVisit").modal("hide");
                // $('#homeVisit').modal().hide();
                $('.cmbSearchList')[0].sumo.unSelectAll();
                $('.sumoSearchList')[0].sumo.unSelectAll();

                // $("#homeVisit").modal("hide");

            }
        });
    });

    $(document).on('click', '.edit-model-hmVisit', function () {
        var url = $(this).attr('data-url');
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            beforeSend: function (xhr) {
                $('.divLoading').show();
            },
            success: function (resp) {
                $('.viewEditModel').html(resp.msg);
                if (resp.approved == null) {
                    $('.btnSave').hide();
                } else {
                    $('.btnSave').show();
                }
                $('.dtpDatePickerDMY').datetimepicker({
                    format: "DD-MM-YYYY",
                    // minDate: moment(),
                    //useCurrent: true
                }),
                    $('.divLoading').hide();
                $(".exampleModal").modal();
            }
        });
    });
    $(document).on('submit', ".upd_hm_visit", function (e) {
        e.preventDefault();
        var url = $(this).attr('action');
        var formData = new FormData($(this)[0]);
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: formData,
            async: false,
            cache: false,
            contentType: false,
            processData: false,
            beforeSend: function (xhr) {
                $('.divLoading').show();
            },
            success: function (resp) {
                $('.divLoading').hide();
                $('.msgBox').show();
                setTimeout(function () {
                    $('.msgBox').fadeOut();
                }, 1500);
                $("#update_home_visit").trigger("reset");
                $("#exampleModal").modal("hide");

            }
        });
    });
    $(document).on('change', '.shorm_stf', function () {
        var id = $(this).val();
        var url = site_url + "registration/getStaffsByShowroom";
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: {
                id: id
            },
            success: function (resp) {
                $('.cmbRegisterAssignTo').html('<option value="">Select staff</option>');
                $.each(resp, function (index, value) {
                    $('.cmbRegisterAssignTo').append('<option value="' + value.col_id + '">' + value.col_title + '(' + value.shr_location + ')</option>');
                });
            }
        });
    });
    //bind purchase table 
    $(document).on('change', '.bndPurchTb', function () {
        var id = $(this).val();
        var url = $(this).attr('data-url') + '/' + id;
        var me = $(this);
        if (id == 0) {
            $(this).parent('th').parent('tr').parent('thead').parent('table').replaceWith(vehDetailsSale);
        } else {
            $.ajax({
                type: 'post',
                url: url,
                dataType: 'json',
                success: function (resp) {
                    $(me).parent('div').parent('th').parent('tr').parent('thead').next('tbody').html(resp.msg);
                }
            });
        }
    });
    /*Jafer*/

    /*JK*/
    /*Stoc*/
    $(".btnSubmitVehicleStatus").click(function () {
        var documentDetails = $('.sts_cmd').val().trim();
        var cmbstatus = $('.cmbstatus').val();
        var val = $('.txtValId').val();
        if (documentDetails) {
            $('.sts_cmd').css('border-color', '');
            if (cmbstatus > 0) {
                $('.cmbstatus').css('border-color', '');
                var url = $(this).data('url');
                $.ajax({
                    type: 'post',
                    url: url,
                    dataType: 'json',
                    data: {
                        cmd: documentDetails,
                        sts: cmbstatus,
                        val: val
                    },
                    success: function (resp) {
                        $('.sts_cmd').val('');
                    }
                });
            } else {
                $('.cmbstatus').css('border-color', 'red');
            }
        } else {
            $('.sts_cmd').css('border-color', 'red');
            $('.sts_cmd').focus();
        }
    });
    $(document).on('click', '.btnAddNewRow', function (e) {
        $('.tbdyProduct').append($('.divRows')[0].outerHTML);
        $('.dtpDMY').datetimepicker({ format: "DD-MM-YYYY" });
    });
    $(document).on('click', '.btnDeleteNewRow', function (e) {
        if ($('.tblSales tbody tr').length > 1) {
            $(this).parent('td').parent('tr').remove();
        }
    });
    $('#supplierID').on('change', function () {
        var supplierID = this.value;
        var url = $(this).attr('data-url');
        $(".tblSales").empty();
        $.ajax({
            type: 'post',
            url: url,
            data: 'supplierID=' + supplierID,
            dataType: "json",
            success: function (resp) {
                $(".tblSales").append(resp.html);
                $('.dtpDMY').datetimepicker({ format: "DD-MM-YYYY" });
            }
        });
    });
    /*Stoc*/
    if (window.location.hash != "") {
        $('a[href="' + window.location.hash + '"]').click();
    }
    $(document).on('change', '.cmbHowDoUKnAbtRD', function (e) {
        var id = $(this).val();
        var url = $(this).data('url');
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: { 'vreg_how_do_you_know_abt_rd': id },
            beforeSend: function (xhr) {
                $('.divLoading').show();
            },
            success: function (resp) {
                $('.divLoading').hide();
                $('.divHowDoCustKnow').html(resp.html);
            }
        });
    });

    /*Booking*/
    $(document).on('change', '.cmbBookPaymentMode', function (e) {
        $('.txtChkAmt').removeAttr('required').removeClass('focused');
        $('.txtChkNum').removeAttr('required').removeClass('focused');
        $('.txtChkBank').removeAttr('required').removeClass('focused');
        $('.txtChkDate').removeAttr('required').removeClass('focused');
        $('.txtChkHolder').removeAttr('required').removeClass('focused');

        $('.txtChkAmt').prop('disabled', false);
        $('.txtChkNum').prop('disabled', false);
        $('.txtChkBank').prop('disabled', false);
        $('.txtChkDate').prop('disabled', false);
        $('.txtChkHolder').prop('disabled', false);

        if ($(this).val() == 1) { // Check
            $('.txtChkNum').attr('required', 'required').addClass('focused');
            $('.txtChkBank').attr('required', 'required').addClass('focused');
            $('.txtChkDate').attr('required', 'required').addClass('focused');
            $('.txtChkAmt').attr('required', 'required').addClass('focused');
            $('.txtChkHolder').attr('required', 'required').addClass('focused');
        } else {
            $('.txtChkNum').prop('disabled', true);
            $('.txtChkBank').prop('disabled', true);
            $('.txtChkDate').prop('disabled', true);
            $('.txtChkHolder').prop('disabled', true);
            $('.txtChkAmt').attr('required', 'required').addClass('focused');
        }
    });
    function calculateVehiclePrice() {
        var ttlAmt = parseFloat($('.txtVehiclePrice').val()) + parseFloat($('.txtTCSAmt').val()) +
            parseFloat($('.txtRTOCharges').val()) + parseFloat($('.txtAddRefurbTotal').val())
            + parseFloat($('.txtAddAccessoriesTotal').val()) + parseFloat($('.txtGrndInsurance').val());
        $('.txtTtlSaleAmt').val(ttlAmt);
        $('.txtBalanceAmt').val(ttlAmt - parseFloat($('.txtAdvanceAmt').val()));
    }

    function calculateTCS() {
        var vehiclePrice = $('.txtVehiclePrice').val() || 0;
        var TCSLimit = $('.txtTCSLimit').val();
        var TCSPer = $('.txtTCSPer').val();
        var tcs = 0;
        if (parseFloat(vehiclePrice) >= parseFloat(TCSLimit)) {
            if ($('.chkIsTCSApply').prop("checked") == true) {
                tcs = (vehiclePrice * TCSPer) / 100;
            } else {
                tcs = 0;
            }
        } else {
            tcs = 0;
        }
        $('.txtTCSAmt').val(tcs);
    }

    var trBokDocs = $(".trBokDocs").prop('outerHTML');
    var trAddRefurb = $(".trAddRefurb").prop('outerHTML');
    var trAddAccessories = $(".trAddAccessories").prop('outerHTML');
    var trRFIPaprColtd = $(".trRFIPaprColtd").prop('outerHTML');

    $(document).on('submit', '.frmReserveVehicle', function (e) {
        e.preventDefault();
        var url = $(this).attr('action');
        //formData = $(this).serialize();
        var formData = new FormData($(this)[0]);
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: formData,
            async: false,
            cache: false,
            contentType: false,
            processData: false,
            beforeSend: function (xhr) {
                $('.divLoading').show();
            },
            success: function (resp) {
                $('.divLoading').hide();
                location.href = site_url + "booking";
            }
        });
    });

    $(document).on('click', '.btnRemoveTableRow', function (e) {
        var _this = $(this);
        var url = _this.data('url');
        if (confirm('Are you sure want to move enquiry and followup!')) {
            $.ajax({
                type: 'post',
                url: url,
                dataType: 'json',
                beforeSend: function (xhr) {
                    //$('.divLoading').show();
                },
                success: function (resp) {
                    //$('.divLoading').hide();
                    _this.closest('tr').hide();
                }
            });
        }
    });
    $(document).on('click', '.btnNewRow', function (e) {
        var target = $(this).data('target');
        $('.tbl' + target).append(trRFIPaprColtd);
    });
    $(document).on('click', '.btnRemoveRow', function (e) {
        $(this).parent('td').parent('tr').remove();
    });
    $(document).on('click', '.chkIsTCSApply', function () {
        calculateTCS();
    });
    $(document).on('keyup', '.txtVehiclePrice, .txtTCSAmt, .txtRTOCharges, .txtAddRefurbTotal, .txtAddAccessoriesTotal, .txtAdvanceAmt', function () {
        calculateVehiclePrice();
    });
    $(document).on('keyup', '.txtVehiclePrice', function () {
        calculateTCS();
    });
    $('.dtpExpDelTime').datetimepicker({ format: "DD-MM-YYYY hh:mm A" });
    $('.dtpDMY').datetimepicker({ format: "DD-MM-YYYY" });

    $('.cmbMultiSelect').multiselect({
        maxHeight: 450,
        enableFiltering: true,
        includeFilterClearBtn: false,
        enableCaseInsensitiveFiltering: true
    });

    $(document).on('click', '.btnReserveVehicle', function () {
        var id = $(this).val();
        var url = $(this).data('url');

        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: { 'id': id },
            beforeSend: function (xhr) {
                //$('.divLoading').show();
            },
            success: function (resp) {
                //$('.divLoading').hide();
                $('.divVehicleDetails').html(resp.html);
                $('.dtpExpDelTime').datetimepicker({ format: "DD-MM-YYYY hh:mm A" });
                $('.dtpDMY').datetimepicker({ format: "DD-MM-YYYY" });
                $('.cmbMultiSelect').multiselect('rebuild');
                $('.popReservationForm_2').modal('toggle');
                trBokDocs = $(".trBokDocs").prop('outerHTML');
                trAddRefurb = $(".trAddRefurb").prop('outerHTML');
                trAddAccessories = $(".trAddAccessories").prop('outerHTML');
            }
        });
    });
    $(document).on('click', '.btnAddBookDocs', function () {
        $('.tblBokDocs').append(trBokDocs);
    });
    $(document).on('click', '.btnNewAddRefurb', function (e) {
        $(".tblAddRefurb").append(trAddRefurb);
    });
    $(document).on('click', '.btnNewAddAccessories', function (e) {
        $(".tblAddAccessories").append(trAddAccessories);
    });

    $(document).on('click', '.btnRemoveAddRefurb', function (e) {
        $(this).parent('td').parent('tr').remove();
    });
    $(document).on('keyup', '.txtReqRefurbAmt', function (e) {
        calculateBookingRefub();
    });
    $(document).on('keyup', '.txtReqAccessoriesAmt', function (e) {
        calculateBookingAccessories();
    });
    $(document).on('keyup', '.txtReqAccessoriesAmt', function (e) {
        calculateBookingAccessories();
    });
    $(document).on('change', '.cmbBookingRefurb', function (e) {
        calculateBookingRefub();
    });
    $(document).on('change', '.cmbBookingAccessories', function (e) {
        calculateBookingAccessories();
    });
    $(document).on('change', '.cmbInsurance', function (e) {
        $('.txtGrndInsurance').val('0.00');
        if ($(this).val() == 2) {
            $('.txtGrndInsurance').val($('.txtInsuranceAmt').val());
        }
        calculateVehiclePrice();
    });

    function calculateBookingRefub() {
        var snpAddRefurbTotal = 0;
        $('.txtReqRefurbAmt').each(function () {
            var authority = $(this).parent('td').next('td').find('select').val();
            if (authority == 2) { // Customer 
                var amt = $(this).val() || 0;
                snpAddRefurbTotal += parseFloat(amt);
            }
        });
        $('.snpAddRefurbTotal').html('Rs/- ' + snpAddRefurbTotal);
        $('.txtAddRefurbTotal').val(snpAddRefurbTotal);
        calculateVehiclePrice();
    }

    function calculateBookingAccessories() {
        var spnAddAccessoriesTotal = 0;
        $('.txtReqAccessoriesAmt').each(function () {
            var authority = $(this).parent('td').next('td').find('select').val();
            if (authority == 2) { // Customer 
                var amt = $(this).val() || 0;
                spnAddAccessoriesTotal += parseFloat(amt);
            }
        });
        $('.spnAddAccessoriesTotal').html('Rs/- ' + spnAddAccessoriesTotal);
        $('.txtAddAccessoriesTotal').val(spnAddAccessoriesTotal);
        calculateVehiclePrice();
    }

    $(document).on('click', '.btnRemoveAddRefurb', function (e) {
        $(this).parent('td').parent('tr').remove();
    });
    $(document).on('click', '.btnBookingForm', function (e) {
        var url = $(this).data('url');
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            beforeSend: function (xhr) {
                //$('.divLoading').show();
            },
            success: function (resp) {
                //$('.divLoading').hide();
                $('.divBookingForm').html(resp.html);
                $('.dtpLeaveDateFrom').datetimepicker({
                    format: "DD-MM-YYYY hh:mm:A",
                    minDate: new Date()
                });
                $('.tblStockVehicle').DataTable();
                $('.cmbVehicleList').SumoSelect({ csvDispCount: 3, search: true, searchText: 'Enter here.' });
                $('.popReservationForm_1').modal('toggle');
            }
        });
    });
    /*Booking*/

    $(document).on('click', '.btnNewRefurbishJob', function (e) {
        //<td><i style="cursor: pointer;" class="fa fa-minus btnRemoveRefurbishJob"></i></td>
        var tmp = '<tr><td></td>' +
            '<td><input type="text" name="newRefrubishjob[refurb_job][]" class="form-control col-md-7 col-xs-12"/></td>' +
            '<td><input type="text" name="newRefrubishjob[refurb_job_cost][]" class="decimalOnly form-control col-md-7 col-xs-12"/></td>' +
            '<td><input type="text" name="newRefrubishjob[actual_job_desc][]" class="form-control col-md-7 col-xs-12"/></td>' +
            '<td><input type="text" name="newRefrubishjob[newcost][]" class="decimalOnly form-control col-md-7 col-xs-12"/></td>' +
            '<td><input type="text" name="newRefrubishjob[desc][]" class="form-control col-md-7 col-xs-12"/></td></tr>';
        $('.tblUpgradeDetails tbody tr:last').after(tmp);
    });
    $(document).on('click', '.btnRemoveRefurbishJob', function (e) {
        $(this).parent('td').parent('tr').remove();
    });
    $(".btn-open-options").click(function () {
        $(".ui-theme-settings").toggleClass("settings-open");
    });
    $('.cmbMultiSelect').multiselect({
        maxHeight: 450,
        enableFiltering: true,
        includeFilterClearBtn: false,
        enableCaseInsensitiveFiltering: true
    });
    $(document).on('keyup', '.txtNextServiceDays', function () {
        var nextServiceDays = $(this).val();
        if (nextServiceDays > 0) {
            var url = $(this).data('url');
            $.ajax({
                type: 'post',
                url: url,
                dataType: 'json',
                data: { 'nextServiceDays': nextServiceDays },
                beforeSend: function (xhr) {
                    $('.txtNxtServiceDate').val('');
                },
                success: function (resp) {
                    $('.txtNxtServiceDate').val(resp);
                }
            });
        } else {
            $('.txtNxtServiceDate').val('');
        }
    });

    $(document).on('submit', '.frmNewFeature', function (e) {
        e.preventDefault();
        var url = $(this).attr('action');
        formData = $(this).serialize();
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: formData,
            beforeSend: function (xhr) {
                $('.btnNewFeature').prop('disabled', true);
            },
            success: function (resp) {
                $('.btnNewFeature').prop('disabled', false);
                var tmp = '<li><input type="checkbox" name="features[' + resp.id + ']" id="checkboxOne' + resp.id + '" value="' + resp.id + '">\n\
                    <label for="checkboxOne' + resp.id + '">' + resp.name + '</label></li>';

                if (resp.isadon == 1) {
                    $('.ulVehicleAdOnFeatures').append(tmp);
                } else {
                    $('.ulVehicleFeatures').append(tmp);
                }
                $('.vftr_feature').val('');
                $(".vftr_features_add_on").prop("checked", false);
                $('.mdlNewFeature').trigger('click');
            }
        });
    });

    $(document).on('submit', '.frmRegisterFollowup', function (e) {
        e.preventDefault();
        var url = $(this).attr('action');
        formData = $(this).serialize();
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: formData,
            beforeSend: function (xhr) {
                $('.btnSubmitRegFollowup').prop('disabled', true);
            },
            success: function (resp) {
                $('.btnSubmitRegFollowup').prop('disabled', false);
                location.reload();
            }
        });
    });
    //Quick followuop TC
    $(document).on('click', '.btnRequestForDrop', function (e) {
        var id = $(this).data('id');
        var url = $('.frmRequestForDrop' + id).data('url');
        var txtDetails = $('.txtReason' + id).val().trim();

        if (txtDetails.length < 30) {
            alert('Please enter atleast 40 characters in customer feedback');
            return false;
        } else {
            $.ajax({
                type: 'post',
                url: url,
                dataType: 'json',
                data: { 'regMaster': $('.txtRegMaster' + id).val(), 'status': $('.txtStatus' + id).val(), 'reason': $('.txtReason' + id).val() },
                beforeSend: function (xhr) {

                },
                success: function (resp) {
                    location.reload();
                }
            });
        }
    });
    $(document).on('click', '.btnSubmitComment', function (e) {
        var id = $(this).data('id');
        var cmt = $('.txtQuickCmd' + id).val().trim();
        var url = $(this).data('url');
        var effective = $('.cmbEffective' + id).val();
        var enqType = $('.cmbEnqType' + id).val();
        if (enqType == 0) {
            alert('Please select type !!');
            return false;
        }
        if (effective == 0) {
            alert('Please efective or not !!');
            return false;
        }
        if (effective == 1) {
            if (cmt != '' && cmt.length > 30) {
                $.ajax({
                    type: 'post',
                    url: url,
                    dataType: 'json',
                    data: { 'id': id, 'cmt': cmt, 'effective': effective, 'enqType': enqType },
                    beforeSend: function (xhr) {
                        $('.divLoading').show();
                    },
                    success: function (resp) {
                        messageBox(resp);
                        $('#trQuickFollow' + id).remove();
                    }
                });
            } else {
                alert('Please write comment at least 30 characters!!');
            }
        } else {
            if (cmt != '') {
                $.ajax({
                    type: 'post',
                    url: url,
                    dataType: 'json',
                    data: { 'id': id, 'cmt': cmt, 'effective': effective, 'enqType': enqType },
                    beforeSend: function (xhr) {
                        $('.divLoading').show();
                    },
                    success: function (resp) {
                        messageBox(resp);
                        $('#trQuickFollow' + id).remove();
                    }
                });
            } else {
                alert('Please write comment !!');
            }
        }
    });
    $(document).on('submit', '.frmQuickAssign', function (e) {
        e.preventDefault();
        var url = $(this).data('url');
        var frm = $(this);
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: $(frm).serializeArray(),
            beforeSend: function (xhr) {
                $('.divLoading').show();
            },
            success: function (resp) {
                messageBox(resp);
            }
        });
    });
    $('.tblQuickFollowupReport').DataTable({
        "order": [[1, "asc"]],
        "processing": true,
        "serverSide": true,
        'serverMethod': 'post',
        "ajax": {
            "type": "POST",
            'data': { 'filter': $('.txtFilters').val() },
            "url": site_url + "reports/quickEnquiryFedBack_ajax"
        },
        'columns': [
            { data: 'enq_entry_date' },
            { data: 'enq_cus_name' },
            { data: 'enq_cus_mobile' },
            { data: 'enq_cus_whatsapp' },
            { data: 'qtr_vehile' },
            { data: 'usr_username' },
            { data: 'replyByTc' },
            { data: 'qtr_replay' },
            { data: 'qtr_reply_on' },
            /*{
                 "mData": null,
                 "bSortable": true,
                 "mRender": function (data, type, row) {
                      if (row.qtr_effective == '1') {
                           return 'Y';
                      } else if (row.qtr_effective == '2') {
                           return 'N';
                      } else {
                           return '';
                      }
                 }
            },
            {
                 "mData": null,
                 "bSortable": true,
                 "mRender": function (data, type, row) {
                      if (row.qtr_type == '1') {
                           return 'Hot';
                      } else if (row.qtr_type == '2') {
                           return 'Warm';
                      } else if (row.qtr_type == '3') {
                           return 'Cold';
                      } else {
                           return '';
                      }
                 }
            },*/
            {
                "mData": null,
                "bSortable": false,
                "mRender": function (data, type, row) {
                    console.log(row.enq_id);
                    return '<a target="_blank" title="Print track card" href="' + site_url + 'enquiry/printTrackCard/' + row.enq_id + '"><span class="glyphicon glyphicon-print"></span></a>';
                }
            }
        ]
    });

    $(document).on('click', '.btnVoxBay', function () {
        bindVoxbayDailyCallReport();
    });

    bindVoxbayDailyCallReport();

    $(document).on('click', '.btnEportVoxbayDailyCallReport', function (e) {
        var url = $(this).data('url');
        //          $.ajax({
        //               type: 'post',
        //               url: url,
        //               dataType: 'json',
        //               data: {
        //                    'fData': $('.dtpDateFrom').val(),
        //                    'tData': $('.dtpDateTo').val(),
        //                    'search' : $('[type=search').val()
        //               }
        //          });
        var salesStaffs = [];
        $('.multiselect-container').find('.active').each(function (index) {
            salesStaffs.push($(this).find('input').val());
        });
        var url = url + "?fData=" + $('.dtpDateFrom').val() + "&tData=" + $('.dtpDateTo').val() + "&search" + $('[type=search').val() +
            '&showroom=' + $('.bindSalesExecutives').val() + "&se=" + salesStaffs;
        window.open(url, '_blank');
    });
    $(document).on('change', '.cmbModeOfContact', function (e) {
        var refCode = '<div class="form-group">' +
            '<label for="enq_cus_remarks" class="control-label col-md-3 col-sm-3 col-xs-12">Referral contact no *</label>' +
            '<div class="col-md-6 col-sm-6 col-xs-12">' +
            '<input required="true" placeholder="Referral contact no" type="text" class="form-control col-md-7 col-xs-12" name="enquiry[enq_ref_phone]"/>' +
            '</div></div>' +
            '<div class="form-group">' +
            '<label for="enq_cus_remarks" class="control-label col-md-3 col-sm-3 col-xs-12">Referral name</label>' +
            '<div class="col-md-6 col-sm-6 col-xs-12">' +
            '<input placeholder="Referral name" type="text" class="form-control col-md-7 col-xs-12" name="enquiry[enq_ref_name]"/>' +
            '</div>' +
            '</div>';
        $('.divReferral').html('');
        if ($(this).val() == 6) {
            $('.divReferral').html(refCode);
        }
    });
    function CopyToClipboard(value, showNotification, notificationText) {
        var $temp = $("<input>");
        $("body").append($temp);
        $temp.val(value).select();
        document.execCommand("copy");
        $temp.remove();

        if (typeof showNotification === 'undefined') {
            showNotification = true;
        }
        if (typeof notificationText === 'undefined') {
            notificationText = "Copied to clipboard";
        }

        var notificationTag = $("div.copy-notification");
        if (showNotification && notificationTag.length == 0) {
            notificationTag = $("<div/>", { "class": "copy-notification", text: notificationText });
            $("body").append(notificationTag);

            notificationTag.fadeIn("slow", function () {
                setTimeout(function () {
                    notificationTag.fadeOut("slow", function () {
                        notificationTag.remove();
                    });
                }, 1000);
            });
        }
    }

    $('.tblCarrers').DataTable({
        "processing": true,
        buttons: [
            'excel'
        ]
    });

    $(document).on('click', '.cpytoclip', function (e) {
        e.preventDefault();
        var copyText = $(this).data("url");
        CopyToClipboard(copyText, true, "Value copied");
        var obj = jQuery.parseJSON('{ "msg": "App referal url coppied" }');
        messageBox(obj);
    });
    $(document).on('click', '.btnCoppy', function (e) {
        e.preventDefault();
        var copyText = $(this).data("section");
        copyText = $(copyText).html();
        CopyToClipboard(copyText, true, "Value copied");
        var obj = jQuery.parseJSON('{ "msg": "Copied to clipboard" }');
        messageBox(obj);
    });
    $(document).on('change', '.cmbContactMode', function (e) {
        registerAssociation();
    });
    $(document).on('keyup', '.vreg_cust_phone', function () {

        registerAssociation();

        var phoneno = $(this).val();
        var url = $(this).data('url');
        //alert(phoneno);
        //alert(url);
        $('.vreg_cust_phone_msg').html("");
        $('.divRegisterHistory').html("");
        if (phoneno.length >= 10 && url !== '') {

            $.ajax({
                type: 'post',
                url: url,
                dataType: 'json',
                data: { 'phoneNo': phoneno },
                success: function (resp) {
                    if (resp.isdrop == 1) {
                        $('.vreg_cust_phone_msg').html(resp.msg);
                        $('.divRegisterHistory').html(resp.regHistory);
                    } else {
                        $('.vreg_cust_phone_msg').html(resp.msg);
                        $('.divRegisterHistory').html(resp.regHistory);
                        if (resp.usr_id !== '') {
                        }
                    }
                }
            });
        }
    });
    $(document).on('change', '#vreg_customer_status', function (e) {
        registerAssociation();
    });

    function registerAssociation() {
        if ($('.chkReferThisCase').prop("checked") == true) {
            $('.divRefer').html($('.tmpRefer').html());
        } else {
            $('.divRefer').html('');
            $('.divModOfContact').html('');
        }

        var regStatus = $('#vreg_customer_status').val();
        var mod = $('.cmbContactMode').val();
        (mod == 5) ? $('.divEvents').show() : $('.divEvents').hide();
        (mod == 34) ? $('.rfrl_type').show() : $('.rfrl_type').hide();
                     (mod != 30) ? $('.rfrl_typeChld').hide() :'' ;
        $('.divModOfContact').html('');
        $('.vreg_cust_phone_msg').html('');
        if (mod == 1 || mod == 5 || mod == 9 || mod == 10 || mod == 11 || mod == 12 || mod == 13 || mod == 7
            || mod == 16 || mod == 14 || mod == 2 || mod == 3 || mod == 4 || mod == 8 || mod == 15 || mod == 21 || mod == 22) {
            //$('.divModOfContact').html($('.tmpAllExecutives').html());
            var phoneno = $('.vreg_cust_phone').val();
            var url = $('.vreg_cust_phone').data('url');
            if (phoneno.length >= 10 && url !== '') {
                $.ajax({
                    type: 'post',
                    url: url,
                    dataType: 'json',
                    data: { 'phoneNo': phoneno },
                    success: function (resp) {
                        $('.vreg_cust_phone_msg').html(resp.msg);
                        if (resp.usr_id !== '') {
                            $('#cmbRegisterAssignTo [value=' + resp.usr_id + ']').attr('selected', 'true');
                        }
                    }
                });
            }
        } else if (($('.chkReferThisCase').prop("checked") == false) && (regStatus == 2 || regStatus == 3)) {
            $('.divModOfContact').html($('.tmpModOfContact').html());
        }
    }
    $(document).on('submit', '.frmFlupEnquiryQuestion', function (e) {
        e.preventDefault();
        var url = $(this).data('url');
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: $('.frmFlupEnquiryQuestion').serializeArray(),
            beforeSend: function (xhr) {
                $('.divLoading').show();
            },
            success: function (resp) {
                messageBox(resp);
            }
        });
    });
    $(document).on('submit', '.frmDAR', function (e) {
        $('.btnDARSubmit').prop('disabled', true);
    });
    if ($('.popupMessage').length > 0) {
        $('.popupMessage').modal('show');
    }
    $(document).on('click', '.btnQuickUpdateFollowup', function () {

        var url = $(this).attr('data-url');
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: $('.frmFollowUpFeedBack').serializeArray(),
            beforeSend: function (xhr) {
                $('.divLoading').show();
            },
            success: function (resp) {
                messageBox(resp);
            }
        });
    });
    $('.tblCheckedList').dataTable({
        columnDefs: [
            { orderable: false, targets: 0 }
        ],
        "lengthMenu": [[10, 25, 50, 500, -1], [10, 25, 50, 500, "All"]]
    });

    /*DAR*/
    $('.cmbSearchList').SumoSelect({ csvDispCount: 3, search: true, searchText: 'Enter here.' });
    $(document).on('click', '.btnDARDates', function (e) {
        var url = $(this).attr('data-url');
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            success: function (resp) {
                $('.divDARDetails').html(resp.html);
                $('#datatable').dataTable();
            }
        });
    });
    $(document).on('submit', '.verifyTeamDAR', function (e) {
        e.preventDefault();
        var isValid = false;
        $('.verifyTeamDAR input[type="text"]').each(function () {
            if (($(this).attr('req') === 'true') && ($(this).val() === '')) {
                $(this).css('border', '1px solid red');
                $(this).parent('td').parent('tr').show();
                isValid = false;
            } else {
                isValid = true;
                $(this).css('border', '1px solid #ccc');
            }
        });

        if (isValid) {
            $(this)[0].submit();
        }
    });

    $(document).on('click', '.btnOpenClose', function () {
        var _this = $(this);
        var tr = $(this).parent('td').parent('tr').next('tr');
        $(tr).toggle('fast', function () {
            if ($(this).css('display') == 'none') {
                $(_this).attr('src', 'images/details_open.png');
            } else {
                $(_this).attr('src', 'images/details_close.png');
            }
        });
        //          var row = table.row(tr);
        //
        //          if (row.child.isShown()) {
        //               // This row is already open - close it
        //               row.child.hide();
        //               tr.removeClass('shown');
        //          } else {
        //               // Open this row
        //               row.child(format(row.data())).show();
        //               tr.addClass('shown');
        //          }
    });
    /*DAR*/
    $('.editor').redactor({
        focus: false,
        lang: 'en',
        imageUpload: site_url + 'seo/uploader',
        plugins: ['fontfamily', 'fontsize', 'fullscreen', 'fontcolor', 'table', 'imagemanager']
    });
    $('.muliSelectCombo').multiselect();
    //$('#val_veh_no').mask('AA-00-AA-0000');
    $(".numOnly").keypress(function (e) {
        //if the letter is not digit then display error and don't type anything
        if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
            //display error message
            var obj = jQuery.parseJSON('{ "msg": "Only number" }');
            messageBox(obj);
            $("#errmsg").html("Digits Only").show().fadeOut("slow");
            return false;
        }
    });
    $(document).on('keypress', '.numOnly', function (e) {
        //if the letter is not digit then display error and don't type anything
        if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
            //display error message
            var obj = jQuery.parseJSON('{ "msg": "Only number" }');
            //messageBox(obj);
            //$("#errmsg").html("Digits Only").show().fadeOut("slow");
            return false;
        }
    });
    $(".emailOnly").blur(function (e) {
        var value = $(this).val();
        var filter = /^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
        if (filter.test(value)) {
            return true;
        } else {
            var obj = jQuery.parseJSON('{ "msg": "Only email" }');
            messageBox(obj);
            return false;
        }
    });
    $('#enq_cus_mobile').blur(function () {
        $('#enq_cus_whatsapp').val('');
        $('#enq_cus_whatsapp').val('91' + $(this).val());
        $('#enq_cus_phone_res').val($(this).val());
    });
    $('.pastContent').blur(function () {
        $($(this).attr('data-past')).val($(this).val());
    });

    $(document).on('click', '.trVOE', function () {
        console.log('trVOE click');
        window.open($(this).closest('tr').attr('data-url'), '_blank');
    });
    /**/
    $(".frmAddFollowUp").validate();
    $('.autoComPlace').autocomplete({
        dataType: 'json',
        serviceUrl: site_url + 'enquiry/autoComPlace'
    });
    $('.autoComOccupation').autocomplete({
        dataType: 'json',
        serviceUrl: site_url + 'enquiry/autoComOccupation'
    });
    $('.autoComCountry').autocomplete({
        dataType: 'json',
        serviceUrl: site_url + 'enquiry/autoComCountry'
    });
    $('.autoComCity').autocomplete({
        dataType: 'json',
        serviceUrl: site_url + 'enquiry/autoComCity'
    });
    $('.autoComDistrict').autocomplete({
        dataType: 'json',
        serviceUrl: site_url + 'enquiry/autoComDistrict'
    });
    $('.autoComState').autocomplete({
        dataType: 'json',
        serviceUrl: site_url + 'enquiry/autoComState'
    });
    $('.autoComVehicleEvaluation').autocomplete({
        dataType: 'json',
        serviceUrl: site_url + 'evaluation/autoComVehicleEvaluation',
        onSelect: function (elements) {
            location.href = site_url + "evaluation/view/" + elements.id_enc;
        }
    });
    $('.autoComCustomer').autocomplete({
        dataType: 'json',
        serviceUrl: site_url + 'evaluation/autoComCustomer',
        onSelect: function (elements) {
            $('.' + $(this).attr('data-id')).val(elements.data);
        }
    });
    $('.autoComSE').autocomplete({
        dataType: 'json',
        serviceUrl: site_url + 'evaluation/autoComSE',
        onSelect: function (elements) {
            $('.' + $(this).attr('data-id')).val(elements.data);
        }
    });
    $(".frmEmployee1").validate({
        rules: {
            usr_phone: {
                required: true,
                number: true
            },
            usr_password: {
                required: true,
                minlength: 6
            },
            usr_password_conf: {
                equalTo: "#usr_password"
            }
        }
    });
    $('.cmbUser').on('change', function () {
        var url = $(this).attr('data-url');
        $('.chkPermissions').prop("checked", false);
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: {
                userid: $(this).val()
            },
            success: function (resp) {
                $.each(resp.permissions, function (index, value) {
                    $("#" + value).prop("checked", true);
                });
            }
        });
    });
    $('.cmbEnqStatus').on('change', function () {
        if ($(this).val() == 1) { // Sell
            $('.divVehDetailsSale').show();
            $('.btnAddVehDetailsSale').show();
            $('.lblSale').show();
            $('.divVehDetailsBuy').hide();
            $('.btnAddVehDetailsBuy').hide();
            $('.lblBuy').hide();

            $('.qstSell').show();
            $('.qstBuy').hide();
            $('.qstExch').hide();
        } else if ($(this).val() == 2) { // Buy
            $('.lblBuy').show();
            $('.divVehDetailsBuy').show();
            $('.btnAddVehDetailsBuy').show();
            $('.divVehDetailsSale').hide();
            $('.btnAddVehDetailsSale').hide();
            $('.lblSale').hide();

            $('.qstSell').hide();
            $('.qstBuy').show();
            $('.qstExch').hide();
        } else { // Exchange
            $('.divVehDetailsSale').show();
            $('.divVehDetailsBuy').show();
            $('.lblSale').show();
            $('.lblBuy').show();
            $('.btnAddVehDetailsBuy').show();
            $('.btnAddVehDetailsSale').show();

            $('.qstSell').hide();
            $('.qstBuy').hide();
            $('.qstExch').show();
        }
    });
    $(document).on('change', '.cmbBindModel', function () {
        $(this).css('border', '1px solid #ccc');
        var id = $(this).val();
        var url = $(this).attr('data-url');
        var $this = $(this);
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: {
                id: id
            },
            success: function (resp) {
                var model = '<select required="true" style="width: 170px;" class="select2_group form-control cmbBindVariant" \n\
                    name="vehicle[sale][veh_model][]" data-url="' + site_url + 'enquiry/bindVarient"><option value="0">Select Model</option>';
                $.each(resp, function (index, value) {
                    model += '<option value="' + value.mod_id + '">' + value.mod_title + '</option>';
                });
                model += '</select>';
                $($this).closest('td').next().html(model);
            }
        });
    });
    $(document).on('change', '.cmbBindVariant', function () {
        $(this).css('border', '1px solid #ccc');
        var id = $(this).val();
        var url = $(this).attr('data-url');
        var $this = $(this);
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: {
                id: id
            },
            success: function (resp) {
                var variant = '<select id="cmbSaleVarient" style="width: 170px;" class="select2_group form-control" name="vehicle[sale][veh_varient][]"><option value="0">Select Variant</option>';
                $.each(resp, function (index, value) {
                    variant += '<option value="' + value.var_id + '">' + value.var_variant_name + '</option>';
                });
                variant += '</select>';
                $($this).closest('td').next().html(variant);
            }
        });
    });
    /*Buy*/
    $(document).on('change', '.cmbBindModelBuy', function () {
        $(this).css('border', '1px solid #ccc');
        var id = $(this).val();
        var url = $(this).attr('data-url');
        var $this = $(this);
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: {
                id: id
            },
            success: function (resp) {
                var model = '<select required="true" style="width: 170px;" class="select2_group form-control cmbBindVariantBuy" \n\
                    name="vehicle[buy][veh_model][]" data-url="' + site_url + 'enquiry/bindVarient"><option value="0">Select Model</option>';
                $.each(resp, function (index, value) {
                    model += '<option value="' + value.mod_id + '">' + value.mod_title + '</option>';
                });
                model += '</select>';
                $($this).closest('td').next().html(model);
            }
        });
    });
    $(document).on('change', '.cmbBindVariantBuy', function () {
        $(this).css('border', '1px solid #ccc');
        var id = $(this).val();
        var url = $(this).attr('data-url');
        var $this = $(this);
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: {
                id: id
            },
            success: function (resp) {
                var variant = '<select style="width: 170px;" class="select2_group form-control" name="vehicle[buy][veh_varient][]"><option value="0">Select Variant</option>';
                $.each(resp, function (index, value) {
                    variant += '<option value="' + value.var_id + '">' + value.var_variant_name + '</option>';
                });
                variant += '</select>';
                $($this).closest('td').next().html(variant);
            }
        });
    });
    /*Bind to drop down*/
    $(document).on('click', '.bindToDiv', function () {
        var id = $(this).val();
        var url = $(this).attr('data-url');
        var bindTo = $(this).attr('data-bind');

        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            success: function (resp) {
                $('.' + bindTo).append(resp.html);
            }
        });
    });
    /*Bind to drop down*/
    $(document).on('change', '.bindToDropdown', function () {
        var id = $(this).val();
        var url = $(this).attr('data-url');
        var bind = $(this).attr('data-bind');
        var defaultSelect = $(this).attr('data-dflt-select');
        var isMultiCheck = $(this).attr('is-multi-check');
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: {
                id: id
            },
            success: function (resp) {
                $('.' + bind).html('');
                if (defaultSelect != '') {
                    $('.' + bind).append('<option value="0">' + defaultSelect + '</option>');
                }
                $.each(resp, function (index, value) {
                    $('.' + bind).append('<option value="' + value.col_id + '">' + value.col_title + '</option>');
                });
                if (isMultiCheck == 1) {
                    $('.cmbMultiSelect').multiselect('rebuild');
                }
            }
        });
    });
    /*Bind to drop down*/
    $(document).on('change', '.bindSalesExecutives', function () {
        var id = $(this).val();
        var url = $(this).attr('data-url');
        var bind = $(this).attr('data-bind');

        $.ajax({
            url: url,
            type: 'post',
            dataType: 'json',
            data: {
                id: id
            },
            success: function (resp) {
                $('.' + bind).empty();
                $.each(resp, function (index, value) {
                    $('.' + bind).append('<option value="' + value.col_id + '">' + value.col_title + '</option>');
                });
                $(".muliSelectCombo").multiselect('rebuild');
            }
        });
    });

    $(document).on('change', '.chkCheckAllChildrens', function (e) {
        var children = $(this).attr('data-child');
        if (false == $(this).prop("checked")) { //if this item is unchecked
            $(children).prop('checked', false);
        } else {
            $(children).prop('checked', true);
        }
    });
    $(document).on('click', '.btnResetMisdFollup', function (e) {
        if ($('input[name="misdFollVehId[]"]:checked').length <= 0) {
            alert('Please select atleast one from list!');
            return false;
        }
        $('#mdlResetMisdFollup').modal('show');
    });
    $(document).on('submit', '.frmReassignFollowup', function (e) {
        e.preventDefault();
        _this = $(this);
        formData = $(this).serialize();
        var url = $(this).attr('action');
        var misdFollEnqId = [];
        $.each($(".misdFollVehId:checked"), function () {
            misdFollEnqId.push($(this).val());
            $('.' + $(this).val()).hide();
        });

        $.ajax({
            type: 'POST',
            url: url + '?' + formData,
            dataType: 'json',
            data: { enqId: misdFollEnqId },
            success: function (resp) {
                messageBox(resp);
                $('.modal').modal('toggle');
            }
        });
    });
    $(document).on('click', '.btnAssignSalesExecutives', function () {
        if ($('input[name="enqid[]"]:checked').length <= 0) {
            alert('Please select atleast one from list!');
            return false;
        }
        var salesExeId = $('.cmbAssignSalesExecutives').val();
        if (salesExeId === '') {
            alert('Please select executive');
            return false;
        }
        if (confirm('Are you sure want to move enquiry and followup!')) {
            var url = $(this).attr('data-url');
            var assignEnqIds = [];
            $.each($(".assignEnqIds:checked"), function () {
                assignEnqIds.push($(this).val());
            });

            $.ajax({
                type: 'POST',
                url: url,
                dataType: 'json',
                data: { 'assignEnqIds': assignEnqIds, 'salesExeId': salesExeId },
                beforeSend: function (xhr) {
                    $('.divLoading').show();
                },
                success: function (resp) {
                    messageBox(resp);
                }
            });
        }
    });
    $(document).on('click', '.btnRemoveEvalComplaint', function () {
        $(this).parent('div').parent('div').remove();
    });
    $('.btnAddEvalComplaint').on('click', function () {
        $('.grpComplaintAndImage').append(
            '<div class="form-group">' +
            '<label for="enq_cus_email" class="control-label col-md-3 col-sm-3 col-xs-12">Compliant Remarks</label>' +
            '<div class="col-md-3 col-sm-3 col-xs-12">' +
            '<input id="comp_complaint" class="form-control col-md-7 col-xs-12"  type="text" name="complaint[]">' +
            '</div>' +
            '<div class="col-md-2 col-sm-2 col-xs-12">' +
            '<input type="file" class="form-control col-md-7 col-xs-12" id="file" name="myfiles[]" />' +
            '</div>' +
            '<div class="col-md-1 col-sm-1 col-xs-12">' +
            '<span style="float: right;cursor: pointer;" class="btnRemoveEvalComplaint glyphicon glyphicon-remove"></span>' +
            '</div>' +
            '</div>'
        );
    });
    $('.btnAddUpgradDet').on('click', function () {
        $('.tbUpgradDet').prepend('<tr><td><input name="upgradedetails[upgrd_key][]" class="txtUpgradDetKey" type="text" style="width: 100%;"/></td>' +
            '<td><input name="upgradedetails[upgrd_value][]" class="txtUpgradDetValue" type="text" style="width: 100%;"/></td>' +
            '<td><span style="cursor: pointer;" class="btnRemUpgradDet glyphicon glyphicon-minus"></span></td>' +
            '</tr>');
        $(".tbUpgradDet input:text").first().focus();
    });
    $(document).on('click', '.btnRemUpgradDet', function () {
        $(this).parent('td').parent('tr').remove();
    });

    /*$(document).on('keypress', '.txtUpgradDetValue', function (event) {
     var keycode = (event.keyCode ? event.keyCode : event.which);
     if (keycode == '13') {
     $('.btnAddUpgradDet').trigger('click');
     }
     });*/

    $(document).on('keyup', '.txtUpgradDetValue', function (e) {
        var refurbValue = 0;
        $('.txtUpgradDetValue').each(function () {
            if (!isNaN(this.value) && this.value.length != 0) {
                refurbValue += parseFloat(this.value);
            }
        });
        $('#val_refurb_cost').val(refurbValue);
    });

    /*New eveluation upload damaged*/
    $('.btnAddDamages').on('click', function () {
        $('.trDamages').after('<tr><td><input class="filDamagesFile" name="complaint_file[]" type="file" style="width: 100%;"/></td>' +
            '<td><input name="complaint_title[]" class="txtDamagesDesc" type="text" style="width: 100%;"/></td><td>' +
            '<span style="cursor: pointer;" class="glyphicon glyphicon-minus btnRemDamages"></span></td></tr>');
    });
    $(document).on('click', '.btnRemDamages', function () {
        $(this).parent('td').parent('tr').remove();
    });

    $(document).on('keypress', '.txtDamagesDesc', function (event) {
        var keycode = (event.keyCode ? event.keyCode : event.which);
        if (keycode == '13') {
            $('.btnAddDamages').trigger('click');
        }
    });

    $('.btnRemoveVehDetailsSale').on('click', function () {
        var url = $(this).attr('data-url');
        var id = $(this).attr('data-id');
        var type = $(this).attr('data-type');
        if (confirm('Are you sure want to delete this item?')) {
            $.ajax({
                type: 'post',
                url: url,
                dataType: 'json',
                success: function (resp) {
                    $('.tblVehicle' + id).remove();
                    $('.btnRemove' + id).remove();
                    if (type === 'sale') {
                        $('.btnAddVehDetailsSale').trigger('click');
                    } else {
                        $('.btnAddVehDetailsBuy').trigger('click');
                    }
                    messageBox(resp);
                }
            });
        }
    });
    $('.deleteRow').on('click', function () {
        if (confirm('Are you sure want to delete?')) {
            var url = $(this).attr('data-url');
            var id = $(this).attr('data-id');
            $.ajax({
                type: 'post',
                url: url,
                dataType: 'json',
                success: function (resp) {
                    $('.deleteRow' + id).hide();
                    messageBox(resp);
                }
            });
        }
    });
    $(document).on('change', '.cmbStock', function () {
        var id = $(this).val();
        var url = $(this).attr('data-url') + '/' + id;
        var me = $(this);
        if (id == 0) {
            $(this).parent('th').parent('tr').parent('thead').parent('table').replaceWith(vehDetailsSale);
        } else {
            $.ajax({
                type: 'post',
                url: url,
                dataType: 'json',
                success: function (resp) {
                    $(me).parent('div').parent('th').parent('tr').parent('thead').next('tbody').html(resp.msg);
                }
            });
        }
    });
    $(document).on('change', '.cmbEnquiryAction', function () {
        var status = $(this).val();
        var url = $(this).attr('data-url');
        if (status != 0) {
            if (confirm('Are you sure want to change status!')) {
                $.ajax({
                    type: 'post',
                    url: url,
                    dataType: 'json',
                    data: {
                        status: status
                    },
                    success: function (resp) {
                        location.href = site_url + 'enquiry';
                    }
                });
            } else {
                $(this).prop('selectedIndex', 0);
            }
        }
    });
    $(document).on('click', '.tagFollowUp', function () {
        var url = $(this).attr('data-url');
        var minDate = $(this).attr('min-date');
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            beforeSend: function (xhr) {
                $('.divLoading').show();
            },
            success: function (resp) {
                $('.viewFollowUp').html(resp.msg);
                $('.dtpNewFollowDate').datetimepicker({
                    //                         format: "DD-MM-YYYY",
                    minDate: moment(),
                    useCurrent: false
                }).on('dp.change', function (ev) {
                    var date = $('.dtpNewFollowDate').val();
                    var url = $('.dtpNewFollowDate').attr('data-url');
                    $.ajax({
                        type: 'post',
                        url: url,
                        dataType: 'json',
                        data: { 'newDate': date, 'currentDate': $('.txtFollowupDate').val() },
                        beforeSend: function (xhr) {
                            $('.divLoading').show();
                            $('.msgFollowup').html('');
                        },
                        success: function (resp) {
                            $.each(resp.data, function (index, value) {
                                $('.foll_customer_feedback_' + value.foll_cus_vehicle_id).html(value.foll_customer_feedback);
                                $('.foll_customer_feedback_' + value.foll_cus_vehicle_id).removeAttr("name").attr("name", 'foll_customer_feedback[' + value.foll_id + ']');
                                /*$('.cmbFollowStatus [value=' + value.foll_status + ']').attr('selected', 'true');
                                 $('.cmbModeOfContact [value=' + value.foll_contact + ']').attr('selected', 'true');
                                 $('.txtNextActionPlan').val(value.foll_action_plan);
                                 $('.txtNextActionPlan').val(value.foll_action_plan);
                                 $('.txtFollowRemarks').val(value.foll_remarks);*/
                            });
                            $('.msgFollowup').html(resp.message);
                            $('.divLoading').hide();
                        }
                    });
                });
                $('.divLoading').hide();
                $(".exampleModal").modal();
            }
        });
    });
    $(document).on('click', '.btnSaveFollowUpFeedBack', function (e) {
        e.preventDefault();
        var url = $(this).attr('data-url');
        var isValid = true;

        $('.foll_customer_feedback').each(function () {
            if ($(this).val() != "") {
                isValid = true;
            }
        });
        $('.divCustomerFeedBack').css("background", "#fff");
        if (!isValid) {
            $('.divCustomerFeedBack').css("background", "#f9dbdb");
        }
        $('.frmFollowUpFeedBack input[required="required"], \n\
                    .frmFollowUpFeedBack textarea[required="required"], \n\
                    .frmFollowUpFeedBack select[required="required"]').each(function () {
            if (($(this).val()) == "") {
                $(this).css("border", "1px solid red");
                isValid = false;
            } else {
                $(this).css("border", "1px solid #ccc");
            }
        });
        $('.frmFollowUpFeedBack input, .frmFollowUpFeedBack textarea').each(function () {
            if ($(this).attr('min')) {
                var len = $(this).val().trim().length;
                var min = $(this).attr('min');
                if (len < min) {
                    alert($(this).attr('min-msg'));
                    $(this).css("border", "1px solid red");
                    $(this).val($(this).val().trim());
                    isValid = false;
                } else {
                    $(this).css("border", "1px solid #ccc");
                }
            }
        });
        if (isValid) {
            $.ajax({
                type: 'post',
                url: url,
                data: $('.frmFollowUpFeedBack').serialize(),
                dataType: 'json',
                beforeSend: function (xhr) {
                    $('.divLoading').show();
                },
                success: function (resp) {
                    if (resp.status == 'fail') {
                        $('.divLoading').hide();
                        messageBox(resp);
                    } else {
                        if (resp.cb) {
                            location.reload();
                        } else {
                            location.reload();
                        }
                    }
                }
            });
        }
    });

    $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
        var url = $(this).attr("data-push-state");

        var obj = {
            Page: '',
            Url: url
        };
        history.pushState(obj, obj.Page, obj.Url);
    });
    $(document).on('click', '.deleteListItem', function () {
        if (confirm('Are you sure want to delete this record?')) {
            var url = $(this).attr('data-url');
            var oTable = $('#datatable').dataTable();
            var rowIndex = oTable.fnGetPosition($(this).closest('tr')[0]);
            $.ajax({
                type: 'post',
                url: url,
                dataType: 'json',
                success: function (resp) {
                    messageBox(resp);
                    oTable.fnDeleteRow(rowIndex);
                }
            });
        }
    });
    $(document).on('click', '.deleteFreezListItem', function () {
        if (confirm('Are you sure want to delete this record?')) {
            var url = $(this).attr('data-url');
            var oTable = $('#datatable').dataTable();
            var rowIndex = oTable.fnGetPosition($(this).closest('tr')[0]);
            $.ajax({
                type: 'post',
                url: url,
                dataType: 'json',
                success: function (resp) {
                    messageBox(resp);
                    oTable.fnDeleteRow(rowIndex);
                    oTable.fnDeleteRow(rowIndex - 1);
                }
            });
        }
    });
    $(document).on('submit', '.frmEvaluation', function (e) {
        e.preventDefault();
        var url = $(this).attr('data-url');
        var formData = new FormData($(this)[0]);
        $('.btn-success').prop('disabled', true);
        $('.btn-success').html('Please wait...');
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            async: false,
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (resp) {
                if (resp.status === 'success') {
                    location.href = site_url + 'evaluation';
                } else {
                    messageBox(resp);
                }
            }
        });
    });

    $(document).on('change', '.cmbTempChnageStatusForOld', function () {
        var url = $(this).attr('data-url');
        var newStatus = $(this).val();

        var oTable = $('#datatable').dataTable();
        var rowIndex = oTable.fnGetPosition($(this).closest('tr')[0]);

        if (newStatus > 0 && confirm('Are you sure want to change status?')) {

            $.ajax({
                type: 'post',
                url: url,
                data: {
                    newStatus: newStatus
                },
                dataType: 'json',
                success: function (resp) {
                    messageBox(resp);
                    oTable.fnDeleteRow(rowIndex);
                }
            });
        }
    });
    $(document).on('change', '.chbFreeze', function () {
        var url = $(this).attr('data-url');
        var status = $(this).prop('checked') ? 9 : 0;
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: {
                status: status
            },
            success: function (resp) {
                messageBox(resp);
            }
        });
    });
    $(document).on('click', '.btnRemoveEnqVehTable', function () {
        var type = $('.cmbEnqStatus').val();
        if (confirm('Are you sure want to remove this vehicle details')) {
            if (type == 1) { // Sell
                if ($('.vehDetailsSale:visible').length <= 1) {
                    alert('Please enter atleast one vehicle details!');
                } else {
                    $(this).parent('th').parent('tr').parent('thead').parent('table').remove();
                }
            } else if (type == 2) { // Buy
                if ($('.vehDetailsBuy:visible').length <= 1) {
                    alert('Please enter atleast one vehicle details!');
                } else {
                    $(this).parent('th').parent('tr').parent('thead').parent('table').remove();
                }
            } else if (type == 3) { // Exchange
                if ($('.vehDetailsSale:visible').length <= 1 && $('.vehDetailsBuy:visible').length <= 1) {
                    alert('Please enter atleast one vehicle details!');
                } else {
                    $(this).parent('th').parent('tr').parent('thead').parent('table').remove();
                }
            }
        }
    });
    $(document).on('change', '.cmbVehicleStatus', function () {
        var status = $(this).val();
        $('.divSalesVehicle').hide();
        $('.cmbFollowupEvaluation').removeAttr('required');
        if (status == 6) { // Request for close
            $('.cmbFollowupEvaluation').attr('required', 'required');
            $('.divSalesVehicle').show();
        }
    });
    $(document).on('change', '.cmbFollowupEvaluation', function () {
        $('.vst_vehicle_id').val($(this).val());
    });
    $(document).on('keyup', '.txtDARExpectedAmt', function () {
        var sum = 0;
        $(".txtDARExpectedAmt").each(function () {
            if (!isNaN(this.value) && this.value.length != 0) {
                sum += parseFloat(this.value);
            }
        });
        $('.txtDarmExpecRevenue').val(sum);
        sum = $.number(sum, 2);
        $('.lblDARExpectedTotal').html(' ' + sum);
    });

    /*Product status changes*/
    $(document).on('change', '.chkStatus', function () {
        var status = $(this).val();
        var url = $(this).attr('data-url');
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: {
                status: status
            },
            success: function (resp) {
                messageBox(resp);
            }
        });
    });
    /*Product status changes*/

    /*Add more image*/
    $(document).on('click', '.btnRemoveProductImages', function () {
        $(this).parent('div').parent('div').remove();
    });
    var index = 1;
    $('.btnMoreProductImages').click(function () {
        $('#divMoreProductImages').append('<div class="form-group">' +
            '<label class="control-label col-md-3 col-sm-3 col-xs-12"></label>' +
            '<div class="col-md-5 col-sm-3 col-xs-12">' +
            '<div id="newupload">' +
            '<input type="hidden" id="x1' + index + '" name="x1[]" />' +
            '<input type="hidden" id="y1' + index + '" name="y1[]" />' +
            '<input type="hidden" id="x2' + index + '" name="x2[]" />' +
            '<input type="hidden" id="y2' + index + '" name="y2[]" />' +
            '<input type="hidden" id="w' + index + '" name="w[]" />' +
            '<input type="hidden" id="h' + index + '" name="h[]" />' +
            '<input type="file" class="form-control" style="display: table;margin-bottom: 10px;" name="prd_image[]" id="image_file' + index + '" onchange="fileSelectHandler(' + index + ', 760, 476)" />' +
            '<img id="preview' + index + '" class="preview"/>' +
            '<span class="help-inline">Choose 760(W) X 476(H)</span>' +
            '</div>' +
            '</div>' +
            '<div class="col-md-1 col-sm-1 col-xs-12">' +
            '<span style="float: right;cursor: pointer;" class="glyphicon glyphicon-minus btnRemoveProductImages"></span>' +
            '</div>');
        index++;
    });
    /*Add more image*/
    /*More documents*/
    $('.btnMoreDocumentsEval').click(function () {
        /*$('.divbtnMoreDocumentsEval').append('<div class="form-group">' +
                '<label for="enq_cus_email" class="control-label col-md-3 col-sm-3 col-xs-12"></label>' +
                '<div class="col-md-3 col-sm-3 col-xs-12">' +
                '<input placeholder="Document name" id="comp_complaint" class="form-control col-md-7 col-xs-12"  type="text" name="document_title[]">' +
                '</div>' +
                '<div class="col-md-2 col-sm-2 col-xs-12">' +
                '<input type="file" class="form-control col-md-7 col-xs-12" id="file" name="documents[]" />' +
                '</div>' +
                '<div class="col-md-1 col-sm-1 col-xs-12">' +
                '<span style="float: right;cursor: pointer;" class="glyphicon glyphicon-minus btnRemoveProductImages"></span>' +
                '</div>' +
                '</div>');*/
        $('.divbtnMoreDocumentsEval').append($('.tmpDocuments').html());
    });
    /*Technical details*/
    $('#btnAddMoreSpecification').click(function () {
        $('#divSpecificatiion').append($('#temSpecification').html());
    });
    $(document).on('click', '.btnRemoveMoreSpecification', function () {
        $(this).closest('.grp-specification').remove();
    });
    /*Other Brands with same specification*/
    $('#btnOtherBrandsWithSameSpecificatiion').click(function () {
        $('#divOtherBrandsWithSameSpecificatiion').append($('#tmpOtherBrandsWithSameSpecificatiion').html());
    });
    $(document).on('click', '.btnRemoveOtherBrandsWithSameSpecificatiion', function () {
        $(this).closest('.grp-specification').remove();
    });

    $(document).on('click', '.radSetDefaultUpdate', function () {
        var data_url = $(this).attr('data-url');
        $.ajax({
            type: "POST",
            url: data_url,
            dataType: "json",
            success: function (msg) {
                messageBox(msg);
            }
        });
    });

    $(document).on('change', '.chkCommon', function () {
        var url = $(this).data('url');
        var status = $(this).prop('checked') ? 1 : 0;
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: {
                status: status
            },
            success: function (resp) {
                messageBox(resp);
            }
        });
    });

    $(document).on('change', '.chkCommonConfirm', function () {
        if (confirm($(this).data('confmsg'))) {
            var oTable = $('#datatable').dataTable();
            var rowIndex = oTable.fnGetPosition($(this).closest('tr')[0]);

            var url = $(this).data('url');
            var status = $(this).prop('checked') ? 1 : 0;
            $.ajax({
                type: 'post',
                url: url,
                dataType: 'json',
                data: {
                    checkedVal: status
                },
                success: function (resp) {
                    if (resp.specialaction == 'removerow') {
                        oTable.fnDeleteRow(rowIndex);
                    }
                    messageBox(resp);
                }
            });
        } else {
            $(this).prop("checked", false);
            return false;
        }
    });

    $(document).on('change', '.cmbCommonPlane', function () {

        var value = $(this).val();
        if (value != '') {
            if (confirm($(this).data('confmsg'))) {
                var url = $(this).data('url');
                var meta = $(this).data('meta');
                $.ajax({
                    type: 'post',
                    url: url,
                    dataType: 'json',
                    data: {
                        value: value,
                        meta: meta
                    },
                    success: function (resp) {
                        messageBox(resp);
                        if (isModelVisible()) {
                            $('.btnCloseModel').trigger('click');
                        }
                    }
                });
            }
        }
    });

    $(document).on('change', '.cmbCommon', function () {
        if (confirm('Are you sure want to change?')) {
            var url = $(this).data('url');
            var value = $(this).val();
            var oTable = $('#datatable').dataTable();
            var rowIndex = oTable.fnGetPosition($(this).closest('tr')[0]);

            $.ajax({
                type: 'post',
                url: url,
                dataType: 'json',
                data: {
                    value: value
                },
                success: function (resp) {
                    messageBox(resp);
                    oTable.fnDeleteRow(rowIndex);
                }
            });
        }
    });

    $('.btnDeleteValuationImage').on('click', function () {
        if (confirm('Are you sure want to delete brnd image?')) {
            var url = $(this).attr('data-url');
            var th = $(this);

            $.ajax({
                type: 'post',
                url: url,
                dataType: 'json',
                success: function (resp) {
                    //$('#imgBrandImage').attr("src", '.' + none_image);
                    $(th).parent('td').parent('tr').hide();
                    showMessage(resp.msg, resp.status);
                    //location.reload();
                }
            });
        }
    });

    /*Delete image*/
    $('.btnDeleteImage').on('click', function () {
        if (confirm('Are you sure want to delete brnd image?')) {
            var url = $(this).attr('data-url');
            var th = $(this);

            $.ajax({
                type: 'post',
                url: url,
                dataType: 'json',
                success: function (resp) {
                    $('#imgBrandImage').attr("src", '.' + none_image);
                    $(th).hide();
                    showMessage(resp.msg, resp.status);
                    location.reload();
                }
            });
        }
    });
    /*Delete image*/
    $('.cmbShowRoom').on('change', function () {
        var showroom = $(this).val();
        var url = $(this).attr('data-url');
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: { 'showroom': showroom },
            success: function (resp) {
                $(".cmbTeamLead").html('');

                $(".cmbTeamLead").append($("<option></option>").val('').html('Select Team Lead'));
                $.each(resp, function (index, value) {
                    $(".cmbTeamLead").append($("<option></option>").val(value.col_id).html(value.col_title));
                });
            }
        });
    });
    $(document).on('keyup', '.vreg_cust_phone', function () {
        var phoneno = $(this).val();
        var url = $(this).data('url');
        if (phoneno.length >= 10 && url !== '') {
            $.ajax({
                type: 'post',
                url: url,
                dataType: 'json',
                data: { 'phoneNo': phoneno },
                success: function (resp) {
                    console.log(resp);
                    if (resp.isdrop == 1) {
                        //$('.btnSubmitRegister').prop('disabled', true);
                        $('.vreg_cust_phone_msg').html(resp.msg);
                    } else {
                        //                              $('.btnSubmitRegister').prop('disabled', false);
                        $('.vreg_cust_phone_msg').html(resp.msg);
                        $('select.cmbSearchList')[0].sumo.selectItem('');
                        //                              $('.cmbSearchList').prop('disabled', false);
                        //                              $('.divAssignTo').html('');
                        if (resp.usr_id !== '') {
                            //                                   $('.cmbSearchList').prop('disabled', false);
                            $('select.cmbSearchList')[0].sumo.selectItem(resp.usr_id);
                            //                                   $('.txtVregAssignedTo').val(resp.usr_id);
                        }
                    }
                }
            });
        }
    });
    $('select.cmbSearchList').on('change', function () {
        $('.txtVregAssignedTo').val($(this).val());
    });
    /*Clock*/
    // Create two variable with the names of the months and days in an array
    var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    var dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

    // Create a newDate() object
    //var newDate = new Date();
    var st = srvTime();
    var newDate = new Date(st);
    // Extract the current date from Date object
    newDate.setDate(newDate.getDate());
    // Output the day, date, month and year    
    $('#Date').html(dayNames[newDate.getDay()] + " " + newDate.getDate() + ' ' + monthNames[newDate.getMonth()] + ' ' + newDate.getFullYear());

    setInterval(function () {
        // Create a newDate() object and extract the seconds of the current time on the visitor's
        var seconds = new Date().getSeconds();
        // Add a leading zero to seconds value
        $("#sec").html((seconds < 10 ? "0" : "") + seconds);
    }, 1000);

    setInterval(function () {
        // Create a newDate() object and extract the minutes of the current time on the visitor's
        var minutes = new Date().getMinutes();
        // Add a leading zero to the minutes value
        $("#min").html((minutes < 10 ? "0" : "") + minutes);
    }, 1000);

    setInterval(function () {
        // Create a newDate() object and extract the hours of the current time on the visitor's
        var hours = new Date().getHours();
        // Add a leading zero to the hours value
        $("#hours").html((hours + 24) % 12 || 12);
    }, 1000);
    /**/
    /*Filter who upload*/
    $(document).on('change', '.cmbWhoUploaded', function () {
        var url = $(this).attr('data-url');
        var id = $(this).val();
        if (id == '-1') {
            window.location.href = url;
        } else {
            window.location.href = url + '?who=' + id;
        }
    });
    /*Filter who upload*/

    /**
     * Common function for checkbox change event
     * Author : JK
     */
    $(document).on('change', '.chkOnchange', function () {
        if (confirm('Are you sure want to change status?')) {
            var url = $(this).attr('data-url');
            var ckd = this.checked ? 1 : 0;
            row = $(this).closest("tr");
            $.ajax({
                type: 'post',
                url: url,
                dataType: 'json',
                data: { ischecked: ckd },
                success: function (resp) {
                    if (url.indexOf("product/changestatus") != -1) {
                        if (ckd == 1) {
                            $("#act_h").html(parseInt($("#act_h").html()) + 1);
                            $("#inact_h").html(parseInt($("#inact_h").html()) - 1);
                        } else {
                            $("#act_h").html(parseInt($("#act_h").html()) - 1);
                            $("#inact_h").html(parseInt($("#inact_h").html()) + 1);
                        }
                        if ($("#crnt_status").val() != "") {
                            row.remove();
                        }
                    }
                    messageBox(resp);
                }
            });
        }
    });

    $(document).on('change', '.cmbBindShowroomByDivision', function () {
        var id = $(this).val();
        var url = $(this).attr('data-url');
        var bind = $(this).attr('data-bind');
        var defaultSelect = $(this).attr('data-dflt-select');
        $.ajax({
            type: 'post',
            url: url,
            dataType: 'json',
            data: {
                id: id
            },
            success: function (resp) {

                $('.cmbShowroom').html('<option value="">Select Showroom</option>');
                $.each(resp.associatedShowroom, function (index, value) {
                    $('.cmbShowroom').append('<option value="' + value.col_id + '">' + value.col_title + '</option>');
                });

                $('.cmbShowroomRefer').html('');
                $.each(resp.notAssociatedShowroom, function (index, value) {
                    $('.cmbShowroomRefer').append('<option value="' + value.col_id + '">' + value.col_title + '</option>');
                });

                $('.cmbDivisionRefer').html('');
                $.each(resp.notAssociatedDivision, function (index, value) {
                    $('.cmbDivisionRefer').append('<option value="' + value.col_id + '">' + value.col_title + '</option>');
                });

                $('.cmbDepartment').html('<option value="">Select department</option>');
                $.each(resp.departments, function (index, value) {
                    var dept = (value.dep_parent_name != null) ? ' (' + value.dep_parent_name + ')' : '';
                    $('.cmbDepartment').append('<option data-issale="' + value.dep_is_sale_rel + '" value="' + value.dep_id + '">' + value.dep_name + dept + '</option>');
                });
            }
        });
    });
    $(document).on('change', '.cmbDepartment', function () {
        var issale = $("option:selected", this).data("issale");
        if (issale == 1) { // Sale related section
            $('.divSale').html($('.tmpSaleRelated').html());
        } else {
            $('.divSale').html('');
        }
    });
    $(document).on('change', '.chkReferThisCase', function () {
        registerAssociation();
    });
    $(document).on('keypress keyup blur', '.decimalOnly', function (event) {
        console.log('decimalOnly');
        //this.value = this.value.replace(/[^0-9\.]/g,'');
        $(this).val($(this).val().replace(/[^0-9\.]/g, ''));
        if ((event.which != 46 || $(this).val().indexOf('.') != -1) && (event.which < 48 || event.which > 57)) {
            event.preventDefault();
        }
    });
});
var xmlHttp;
function messageBox(responce) {
    $('#msgBox').show();
    $('#msgBox').modal('show');
    $('.divLoading').hide();
    //     $('.divLoading').hide();
    //     $('.msgBox').show();
    //     $(".msgBoxAj").show();
    $(".sus_msg").html(responce.msg);
    //     $('.msgBox').delay(5000).fadeOut('slow');
}

function isModelVisible() {
    if ($('.modal').is(':visible')) {
        return true;
    } else {
        return false;
    }
}

function srvTime() {
    try {
        //FF, Opera, Safari, Chrome
        xmlHttp = new XMLHttpRequest();
    } catch (err1) {
        //IE
        try {
            xmlHttp = new ActiveXObject('Msxml2.XMLHTTP');
        } catch (err2) {
            try {
                xmlHttp = new ActiveXObject('Microsoft.XMLHTTP');
            } catch (eerr3) {
                //AJAX not supported, use CPU time.
                alert("AJAX not supported");
            }
        }
    }
    xmlHttp.open('HEAD', window.location.href.toString(), false);
    xmlHttp.setRequestHeader("Content-Type", "text/html");
    xmlHttp.send('');
    return xmlHttp.getResponseHeader("Date");
}